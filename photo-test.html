<!DOCTYPE html>
<html>
<head>
    <title>Photo Display Test</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ccc; }
        .photo { width: 150px; height: 150px; object-fit: cover; border: 1px solid #ddd; margin: 10px; }
        .success { color: green; }
        .error { color: red; }
    </style>
</head>
<body>
    <h1>üì∏ Photo Display Test</h1>
    
    <div class="test-section">
        <h3>Test Photo URL Construction</h3>
        <button onclick="testPhotoUrl()">Test Photo URLs</button>
        <div id="urlResults"></div>
    </div>

    <div class="test-section">
        <h3>Test Photo Loading</h3>
        <button onclick="testPhotoLoading()">Load Test Photos</button>
        <div id="photoResults"></div>
    </div>

    <div class="test-section">
        <h3>Test Cache Busting</h3>
        <button onclick="testCacheBusting()">Test Cache Busting</button>
        <div id="cacheResults"></div>
    </div>

    <script>
        function testPhotoUrl() {
            const baseUrl = 'http://localhost:3001';
            const testPaths = [
                'Photos/patient Admission/P0114/photo_1755860546705.jpg',
                'Photos\\patient Admission\\P0114\\photo_1755860546705.jpg',
                '/Photos/patient Admission/P0114/photo_1755860546705.jpg'
            ];
            
            const resultsDiv = document.getElementById('urlResults');
            resultsDiv.innerHTML = '<h4>URL Construction Results:</h4>';
            
            testPaths.forEach((path, index) => {
                const timestamp = Date.now();
                const random = Math.random().toString(36).substring(7);
                const cacheBuster = `?t=${timestamp}&r=${random}`;
                
                // Clean path
                let cleanPath = path.replace(/\\/g, '/').replace(/\/+/g, '/');
                if (!cleanPath.startsWith('Photos/') && !cleanPath.startsWith('/Photos/')) {
                    cleanPath = cleanPath.startsWith('/') ? `Photos${cleanPath}` : `Photos/${cleanPath}`;
                }
                
                const finalUrl = `${baseUrl}/${cleanPath.replace(/\s/g, '%20')}${cacheBuster}`;
                
                resultsDiv.innerHTML += `
                    <div>
                        <strong>Test ${index + 1}:</strong><br>
                        Input: ${path}<br>
                        Clean: ${cleanPath}<br>
                        Final: ${finalUrl}<br>
                        <a href="${finalUrl}" target="_blank">Test Link</a>
                        <hr>
                    </div>
                `;
            });
        }

        function testPhotoLoading() {
            const resultsDiv = document.getElementById('photoResults');
            resultsDiv.innerHTML = '<h4>Photo Loading Test:</h4>';
            
            // Test the actual photo from the logs
            const photoPath = 'Photos/patient Admission/P0114/photo_1755860546705.jpg';
            const baseUrl = 'http://localhost:3001';
            const timestamp = Date.now();
            const random = Math.random().toString(36).substring(7);
            const cacheBuster = `?t=${timestamp}&r=${random}`;
            const photoUrl = `${baseUrl}/${photoPath.replace(/\s/g, '%20')}${cacheBuster}`;
            
            const img = document.createElement('img');
            img.className = 'photo';
            img.onload = function() {
                resultsDiv.innerHTML += '<div class="success">‚úÖ Photo loaded successfully!</div>';
            };
            img.onerror = function() {
                resultsDiv.innerHTML += '<div class="error">‚ùå Photo failed to load</div>';
                resultsDiv.innerHTML += `<div>URL: ${photoUrl}</div>`;
            };
            img.src = photoUrl;
            
            resultsDiv.appendChild(img);
            resultsDiv.innerHTML += `<div>Testing URL: ${photoUrl}</div>`;
        }

        function testCacheBusting() {
            const resultsDiv = document.getElementById('cacheResults');
            resultsDiv.innerHTML = '<h4>Cache Busting Test:</h4>';
            
            const photoPath = 'Photos/patient Admission/P0114/photo_1755860546705.jpg';
            const baseUrl = 'http://localhost:3001';
            
            // Test multiple cache busters
            for (let i = 0; i < 3; i++) {
                setTimeout(() => {
                    const timestamp = Date.now();
                    const random = Math.random().toString(36).substring(7);
                    const cacheBuster = `?t=${timestamp}&r=${random}`;
                    const photoUrl = `${baseUrl}/${photoPath.replace(/\s/g, '%20')}${cacheBuster}`;
                    
                    const img = document.createElement('img');
                    img.className = 'photo';
                    img.style.border = '2px solid blue';
                    img.onload = function() {
                        resultsDiv.innerHTML += `<div class="success">‚úÖ Cache bust ${i+1}: Loaded at ${new Date().toLocaleTimeString()}</div>`;
                    };
                    img.onerror = function() {
                        resultsDiv.innerHTML += `<div class="error">‚ùå Cache bust ${i+1}: Failed at ${new Date().toLocaleTimeString()}</div>`;
                    };
                    img.src = photoUrl;
                    
                    resultsDiv.appendChild(img);
                }, i * 1000);
            }
        }

        // Auto-run basic test on load
        window.onload = function() {
            testPhotoUrl();
        };
    </script>
</body>
</html>
